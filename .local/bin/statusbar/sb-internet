#!/usr/bin/env bash

ssid=$(if=wlan0
		while IFS=$': \t' read -r label value
		do
			case $label in SSID) SSID=$value
				;;
			signal) SIGNAL=$value
				;;
		esac
	done < <(iw "$if" link)
    test "$SIGNAL" && echo -e "at ($SSID) ")

if grep -xq 'up' /sys/class/net/w*/operstate 2>/dev/null ; then
    wifiicon="$(awk '/^\s*w/ { print int($3 * 100 / 70) "% " }' /proc/net/wireless)"
    wcolor="#00ff00"
elif grep -xq 'down' /sys/class/net/w*/operstate 2>/dev/null ; then
    grep -xq '0x1003' /sys/class/net/w*/flags && wifiicon="NoConnection " || wifiicon="down "
    wcolor="#ff0000"
fi

ethstatus="$(cat /sys/class/net/e*/operstate 2>/dev/null)"
if [ $ethstatus = "up" ]; then
    ethcolor="#00ff00"
else
    ethcolor="#ff0000"
fi

printf "<span color=\"$wcolor\">%s</span><span color=\"$ethcolor\">%s</span>%s\n" "W: $wifiicon$ssid" "E: $ethstatus" "$(sed "s/.*/ðŸ”’/" /sys/class/net/tun*/operstate 2>/dev/null)"
