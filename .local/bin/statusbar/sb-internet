#!/usr/bin/env bash

ssid=$(if=wlan0
		while IFS=$': \t' read -r label value
		do
			case $label in SSID) SSID=$value
				;;
			signal) SIGNAL=$value
				;;
		esac
	done < <(iw "$if" link)
    test "$SIGNAL" && echo -e "at ($SSID) ")

if grep -xq 'up' /sys/class/net/w*/operstate 2>/dev/null ; then
    wifiicon="$(awk '/^\s*w/ { print int($3 * 100 / 70) "% " }' /proc/net/wireless)"
elif grep -xq 'down' /sys/class/net/w*/operstate 2>/dev/null ; then
    grep -xq '0x1003' /sys/class/net/w*/flags && wifiicon="NoConnection " || wifiicon="down "
fi

printf "%s%s%s\n" "W-$wifiicon$ssid" "E-$(cat /sys/class/net/e*/operstate 2>/dev/null)" "$(sed "s/.*/ðŸ”’/" /sys/class/net/tun*/operstate 2>/dev/null)"
