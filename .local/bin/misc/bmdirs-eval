#!/usr/bin/env bash

# evaluates and adds bookmarked dirs in bmdirs file to all dirs
# then it appends deap resultant dirs that start with ! in bmdirs file

bmdirs="$XDG_CONFIG_HOME/shell/bm-dirs"
alldirs="$XDG_CONFIG_HOME/shell/all-dirs"

# ignore comments, blank lines, and whitespaces
eval "echo \"$(cat "$bmdirs")\"" | \
sed -e 's/\s*#.*//' -e '/^$/d' -e 's/^\S*\s*//' -e '/^!.*/d' > "$alldirs"&&

readarray -t dirs < <(eval "echo \"$(grep -E '^!.*' "$bmdirs" | sed -e 's/\s*#.*//')\"")

for dir in "${dirs[@]}"; do
    # ignore hidden dirs
    if echo "$dir" | grep -q "^!!!"; then
        depth="3"
    elif echo "$dir" | grep -q "^!!"; then
        depth="2"
    else
        depth="1"
    fi

    find $(echo $dir | cut -d ' ' -f 2) -maxdepth "$depth" \( ! -regex '.*/\..*' \)  -type d  >> "$alldirs"
done

# remove duplicates
sort -u -o "$alldirs" "$alldirs"
