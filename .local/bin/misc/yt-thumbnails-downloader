#!/bin/sh

for file in "$@"; do
    filename=$(basename "$file")
    youtube-dl --match-filter "!short"  --write-thumbnail -o "%(title)s.%(ext)s" --convert-thumbnail jpg --skip-download "ytsearch:${filename%.*}" -P "$HOME/.cache/yt-audio-thumbnails/"
    title="$(youtube-dl --match-filter "!short" --get-title -o "%(title)s.%(ext)s" --skip-download "ytsearch:${filename%.*}")"
    extension="${file##*.}"
    newtitle="$title.$extension"
    [ ! -f "newtitle" ] && mv "$file" "$newtitle"
done
