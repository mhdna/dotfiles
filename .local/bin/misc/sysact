#!/bin/sh

export WM="dwm"
case "$(readlink -f /sbin/init)" in
	*systemd*) ctl='systemctl' ;;
	*) ctl='loginctl' ;;
esac

wmpid(){ # This function is needed if there are multiple instances of the window manager.
    pidof "$WM" | cut -d ' ' -f 2
	# tree="$(pstree -ps $$)"
	# tree="${tree#*$WM(}"
	# echo "${tree%%)*}"
}

case "$(printf "lock\nleave\nhibernate\nreload dwm\nreboot\npoweroff\nsuspend\ndisplay off" | dmenu -i -p 'Action: ')" in
	"lock") physlock -s ;;
	"leave") pkill -15 -t tty"$XDG_VTNR" Xorg ;;
	"hibernate") $ctl hibernate ;;
	"suspend") $ctl suspend -i;;
    "reload $WM") kill -HUP "$(wmpid)";;
	"reboot") $ctl reboot -i ;;
	"poweroff") $ctl poweroff -i ;;
	"display off") xset dpms force off ;;
	*) exit 1 ;;
esac
